(ns thinkfp.ch3
  (:require [thinkfp.utils :as ut]
            [clojure.pprint :as pp]))

(def ^:dynamic ceil-joint "+")
(def ^:dynamic wall-joint "|")

(defn make-component [joint mater len]
  "Makes a component of length len
  (make-component + - 3)
  => (+ - - -)"
  (concat [joint] (repeat len mater)))

(defn join-components [mater joint len]
  "Joins components and finish it with a joint
  (join-components row floor 3)
  => (row row row floor)"
  (concat (repeat len mater) [joint]))

(defn make-tile [joint mater]
  "ex: + - - -"
  (partial make-component joint mater))

(def ^:dynamic tile (make-tile "+" "-"))
(def ^:dynamic brick (make-tile "|" " "))

(defn make-ceil [col len]
  "Ceiling is a series of tiles ending with +.
    + - - - + - - - +"
  (let [ceil-component (tile len)]
    (join-components ceil-component ceil-joint col)))

(defn make-wall [col len]
  "Wall is a series of bricks ending with |
    | s s s | s s s |"
  (let [wall-component (brick len)]
    (join-components wall-component wall-joint col)))

(defn make-row [row col len]
  "A row is one ceiling and 'len' of wall-layers"
  (let [ceil (make-ceil col len)
        wall (make-wall col len)]
    (make-component ceil wall len)))

(defn make-grid [row col len]
  "Generate grid of row's and col's
  grid = rows(row) + (floor)"
  (let [floor (make-ceil col len)
        rows (make-row row col len)]
    (join-components rows floor row)))

(defn draw [elem]
  (-> elem
      flatten
      ut/join
      println))

(defn draw-row [row]
  (ut/foreach draw row))

(defn draw-grid [row col len]
  (let [grid (make-grid row col len)]
    (do 
      (ut/foreach draw-row (butlast grid))
      (draw (last grid)))))

